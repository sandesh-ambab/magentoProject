
<?php

use Elasticsearch\Endpoints\Ml\Forecast;

if ($block->toShowBlock()): ?>
<a href="#" id="click-me">EMI starts from $399</a>
<?php endif; ?>

<div id="popup-modal">
    <h3> EMI details of banks</h3>
    <?php
            $price = $block->getProductPrize();
            $collection = $block->getCollection();
    ?>
    

        <table class="data table" id="test-data-table">
                <caption class="table-caption">Vky Test Data</caption>
                <thead>
                    <tr>
                        <th scope="col" class="col title">Id</th>
                        <th scope="col" class="col author">Bank Name</th>
                        <th scope="col" class="col content">Month</th>
                        <th scope="col" class="col created_at">Rate of Interest</th>
                        <th scope="col" class="col actions">Price</th>
                        <th scope="col" class="col actions">Emi amount</th>
                    </tr>
                </thead>
                <tbody>
                <?php 
                    foreach ($collection as $data):
                    $month = $data->getMonth();
                    $roi = $data->getRoi();
                    $roi = $roi / (12 * 100);
                    $emi = ($price * $roi * pow(1 + $roi, $month)) /  
                            (pow(1 + $roi, $month) - 1); 
                    $emiamt = round($emi);
                    ?>
                        <tr>
                            <td data-th="Title" class="col title"><?php echo $data->getId(); ?></td>
                            <td data-th="Author" class="col author"><?php echo $data->getBankName(); ?></td>
                            <td data-th="Content" class="col content"><?php echo $data->getMonth(); ?></td>
                            <td data-th="Date" class="col created_at"><?php echo $data->getRoi(); ?></td>
                            <td data-th="Date" class="col created_at"><?php echo $price; ?></td>
                            <td data-th="Date" class="col created_at"><?php echo $emiamt; ?></td>

                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
    </div>
<script>
    require(
    [
        'jquery',
        'Magento_Ui/js/modal/modal'
    ],
    function(
        $,
        modal
    ) {
        var options = {
            type: 'popup',
            responsive: true,
            innerScroll: true,
            buttons: [{
                text: $.mage.__('Ok'),
                class: 'mymodal1',
                click: function () {
                    this.closeModal();
                }
            }]
        };

        var popup = modal(options, $('#popup-modal'));
        $("#click-me").on('click',function(){
            $("#popup-modal").modal("openModal");
        });
    }
);
</script>



